<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>    <!-- Metadata, OpenGraph and Schema.org -->
    
    <!-- Website verification -->
    <meta name="google-site-verification" content="" /><meta name="msvalidate.01" content="" />

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Xusheng Chen's Homepage | About ballots in Paxos</title>
    <meta name="author" content="Xusheng  Chen" />
    <meta name="description" content="Why does Paxos need majority acceptance of a value with the same ballot?" />
    <meta name="keywords" content="distributed database" />


    <!-- Bootstrap & MDB -->
    <link href="https://unpkg.com/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous" />

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="/assets/css/github-highlight.css" media="none" id="highlight_theme_light" />

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚛️</text></svg>">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://michaelxschen.github.io/blog/2022/paxos/">
    
    <meta name="google-site-verification" content="hIGkTMm5o1EBurk5w58vT5-HiNIhn7xYiW_bK7Tvf74" />
  
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="/assets/css/github-highlight.css" media="none" id="highlight_theme_dark" />

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    


  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="https://michaelxschen.github.io/">Xusheng Chen's Homepage</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">About</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">Blog</a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/cv/">CV</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">Publications</a>
              </li>

              <!-- Toogle theme mode -->
              <div class="toggle-container">
                <a id="light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </a>
              </div>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- Content -->
    <div class="container mt-5">
      <!-- _layouts/post.html -->

<div class="post">

  <header class="post-header">
    <h1 class="post-title">About ballots in Paxos</h1>
    <p class="post-meta">June 15, 2022</p>
    <p class="post-tags">
      <a href="/blog/2022"> <i class="fas fa-calendar fa-sm"></i> 2022 </a>
        ·  
        <a href="/blog/tag/consistency">
          <i class="fas fa-hashtag fa-sm"></i> consistency</a>  
          
        ·  
        <a href="/blog/category/thoughts">
          <i class="fas fa-tag fa-sm"></i> thoughts</a>  
          

    </p>
  </header>

  <article class="post-content">
    <p>Recently I am reading papers about asynchronous consensus protocols, and I was 
trying to contrast these protocols with Paxos <a class="citation" href="#paxos">(Lamport, 2001)</a> and PBFT <a class="citation" href="#pbft">(Castro et al., 1999)</a>. 
When re-reading the Paxos
paper, some of the design points take me some time to reason about. 
These thoughts may seem naive for Paxos experts, but I will just jot them down.</p>

<p>In Paxos, a value is confirmed only if it is accepted <em>with the same ballot</em> by a majority
of acceptors. Why is having a majority of acceptors accept the same value not enough?</p>

<p>(At first, I thought the <em>accept</em> action in Paxos corresponds to <em>decide</em> in Ben-Or’s algorithm <a class="citation" href="#benor">(Ben-Or, 1983)</a>, and thus
I was wondering why Ben-Or’s algorithm can let nodes decide a value <em>in different rounds</em>, 
but Paxos requires a majority of nodes to accept <em>with the same ballot</em>. However, this 
comparison is wrong. Ben-Or’s <em>decide</em> is more like the behavior of learners in 
Paxos, and Ben-Or’s algorithm can be regarded as skipping the first phase of Paxos if 
we have to parallelize them.)</p>

<p>To answer this question, we can simply construct a counterexample which shows that, after a majority
of acceptors have accepted a same value \(v\) with different ballots, the system may decide 
a different value \(v'\). I will use \((n, v)\) to denote a proposal of value \(v\) with ballot \(n\).</p>

<p>Let’s use the simplest setting with 3 acceptors \(A_1, A_2, A_3\), where \(A_1\) has accepted \((n_1, v)\)
and \(A_2\) has accepted \((n_2, v)\). Without losing generality, let \(n_1 &lt; n_2\). Now we want one of 
them to switch to accept another value \((n', v')\) (after which another proposer can let the system accept
\(v'\) by forming a majority with \(A_3\)). For simplicity, we assume there are no other concurrent 
proposals.</p>

<p>If the prepare message of $n’$ arrives after \(A_1\) and \(A_2\) accept \(v\), its proposer will learn
and propose \(v\), so at least one of  \(A_1\) and \(A_2\) must prepare \(n'\) before accepting \(v\). On the other hand,
\(n'\) cannot be smaller than both \(n_1\) and \(n_2\), otherwise they will ignore the accept message for 
\(v'\), so we have \(n_1 &lt; n' &lt; n_2\).</p>

<p>We visualize the construction below. A new proposer can use \(A_1, A_3\) to form a majority, and let the system 
accept \(v_2\) at the end, even if two acceptors have accepted \(v_1\) with different ballots at some time.</p>

<p><img src="/assets/figures/paxos-ballot.png" alt="Paxos-Ballot"></p>

<p>Overall, in Paxos, although an acceptor will try to let subsequent proposers follow
its accepted value, the proposer can find a majority/quorum without including this acceptor.
Even if a majority of acceptors accept the same value \(v\), if they are not of the same ballot, another 
proposer can still succeed in letting a majority of acceptors prepare a ballot that lies 
in the gap among the accepted ballots for \(v\) before they all accept \(v\).</p>

<p>This makes me think about another possible design. <em>What if we can have a method 
that makes there no gap between the ballots for accepting the same value?</em> I did
not conduct a formal proof, but it seems to be enough for correctness. However, how can 
we ensure there are no new ballots can be inserted? Using consecutive integers? Using<br>
timestamps and safe timestamp mechanism?</p>

<p>Another thought is about the proposed value. In Ben-Or’s algorithm, a node tries to follow the value from other nodes in its Phase-1
in order to facilitate convergence. In contrast, in Phase-1 of Paxos, the
proposer does not follow the value prepared by acceptors; its proposed 
value is affected only by accepted values.</p>

<p>What if we adapt Paxos and let a proposer follow the value observed in Phase-1. I was 
thinking this may make it possible to enable Paxos to confirm a value by accepting it value with different ballots.
However, by simple variants of the previous construction, we can see that it is not correct. However, will this 
adaption cannot make the consecutive-ballot design viable?</p>

<p>Anyway, these are just some random thought, and I did not spend much time to verify them, as 
the vanilla Paxos (Paxos-made-simple without a stable leader) is rarely used in deployments.</p>

<h2 id="references">References:</h2>

<ol class="bibliography">
<li>
<!-- _layouts/bib.html -->
      <div class="row">
        <!-- Entry bib key -->
        <div id="paxos" class="col-sm-12">
        
          <!-- Author -->
          <span class="author">Leslie Lamport
          </span>.
          <!-- Title -->
          <span class="title">Paxos made simple</span>.
          <!-- Journal/Book title and date -->
          <span class="periodical">
            <em>ACM SIGACT News (Distributed Computing Column) 32, 4 (Whole Number 121, December 2001)</em> 2001
          </span>
        
          <!-- Links/Buttons -->
          <div class="links">
          </div>

          
        </div>
      </div>
</li>
<li>
<!-- _layouts/bib.html -->
      <div class="row">
        <!-- Entry bib key -->
        <div id="pbft" class="col-sm-12">
        
          <!-- Author -->
          <span class="author">Miguel Castro,  Barbara Liskov,  and  others
          </span>.
          <!-- Title -->
          <span class="title">Practical byzantine fault tolerance</span>.
          <!-- Journal/Book title and date -->
          <span class="periodical">
            <em>In OsDI</em> 1999
          </span>
        
          <!-- Links/Buttons -->
          <div class="links">
          </div>

          
        </div>
      </div>
</li>
<li>
<!-- _layouts/bib.html -->
      <div class="row">
        <!-- Entry bib key -->
        <div id="benor" class="col-sm-12">
        
          <!-- Author -->
          <span class="author">Michael Ben-Or
          </span>.
          <!-- Title -->
          <span class="title">Another advantage of free choice (extended abstract) completely asynchronous agreement protocols</span>.
          <!-- Journal/Book title and date -->
          <span class="periodical">
            <em>In Proceedings of the second annual ACM symposium on Principles of distributed computing</em> 1983
          </span>
        
          <!-- Links/Buttons -->
          <div class="links">
          </div>

          
        </div>
      </div>
</li>
</ol>

  </article>

</div>

    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2022 Xusheng  Chen. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>.
Last updated: September 12, 2022.
      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://unpkg.com/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://unpkg.com/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://unpkg.com/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script src="https://unpkg.com/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script src="/assets/js/common.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://unpkg.com/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id="></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', '');
  </script><!-- Panelbear Analytics - We respect your privacy -->
  <script async src="https://cdn.panelbear.com/analytics.js?site="></script>
  <script>
    window.panelbear = window.panelbear || function() { (window.panelbear.q = window.panelbear.q || []).push(arguments); };
    panelbear('config', { site: '' });
  </script>
  </body>
</html>

